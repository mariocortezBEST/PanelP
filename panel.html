<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Árbol de Decisión: Patrones de Diseño</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Slab:wght@400;700&family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #f4f7f9;
            --node-bg: #ffffff;
            --text-color: #333;
            --text-light: #555;
            --border-color: #dbe2e8;
            --shadow-color: rgba(0, 0, 0, 0.08);
            --accent-color: #007bff;
            --color-problem: #ff6b6b;
            --color-question: #48dbfb;
            --color-pattern: #1dd1a1;
            --font-heading: 'Roboto Slab', serif;
            --font-body: 'Roboto', sans-serif;

            /* Futuristic Panel Colors */
            --panel-bg: rgba(22, 28, 41, 0.95);
            --panel-text: #e0e5f0;
            --panel-text-heading: #58a6ff;
            --panel-border: rgba(88, 166, 255, 0.3);
            --panel-shadow: rgba(88, 166, 255, 0.2);
            --panel-accent-glow: #007bff;
        }

        body {
            font-family: var(--font-body);
            background-color: var(--bg-color);
            color: var(--text-color);
            padding: 2em;
            line-height: 1.6;
        }

        .app-container {
            max-width: 100%;
            overflow-x: auto;
        }
        
        #tree-container {
            display: flex;
            align-items: flex-start;
            gap: 60px;
            padding: 20px;
            position: relative;
        }
        
        .connections-svg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
        }

        .level {
            display: flex;
            flex-direction: column;
            gap: 20px;
            min-width: 300px;
            z-index: 1;
        }

        .node {
            background-color: var(--node-bg);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 15px 20px;
            text-align: center;
            box-shadow: 0 4px 12px var(--shadow-color);
            transition: all 0.3s ease;
            position: relative;
        }
        
        .node.clickable {
            cursor: pointer;
        }
        
        .node.clickable:hover {
             transform: translateY(-5px) scale(1.02);
             box-shadow: 0 8px 20px var(--shadow-color);
        }

        .node.selected {
            border-color: var(--accent-color);
            box-shadow: 0 0 15px rgba(0, 123, 255, 0.4);
        }

        .node-problem { border-left: 8px solid var(--color-problem); }
        .node-question { border-left: 8px solid var(--color-question); }
        .node-pattern { 
            border-left: 8px solid var(--color-pattern); 
            font-weight: 500;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 15px;
        }

        .code-link {
            font-size: 0.8em;
            font-weight: 500;
            color: var(--accent-color);
            text-decoration: none;
            padding: 4px 8px;
            border-radius: 5px;
            border: 1px solid var(--accent-color);
            transition: all 0.2s ease;
            margin-left: 10px;
            white-space: nowrap;
        }

        .code-link:hover {
            background-color: var(--accent-color);
            color: white;
        }


        .hidden {
            display: none;
        }
        
        #info-panel {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.9);
            background-color: var(--panel-bg);
            backdrop-filter: blur(10px);
            color: var(--panel-text);
            width: 90%;
            max-width: 750px;
            max-height: 85vh;
            overflow-y: auto;
            border-radius: 15px;
            border: 1px solid var(--panel-border);
            box-shadow: 0 0 40px var(--panel-shadow);
            z-index: 1000;
            padding: 25px 35px;
            text-align: left;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease-in-out;
        }

        #info-panel.visible {
            transform: translate(-50%, -50%) scale(1);
            opacity: 1;
            visibility: visible;
        }

        #info-panel-close {
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 2em;
            font-weight: 300;
            cursor: pointer;
            color: var(--panel-text-heading);
            border: none;
            background: none;
            transition: color 0.2s;
        }
        #info-panel-close:hover {
            color: white;
        }
        
        .panel-header {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 10px;
        }
        
        #info-icon-container {
            flex-shrink: 0;
            width: 60px;
            height: 60px;
            background-color: rgba(88, 166, 255, 0.1);
            border-radius: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #info-icon-container svg {
            width: 40px;
            height: 40px;
            stroke: var(--panel-accent-glow);
        }

        #info-panel h2 {
            font-family: var(--font-heading);
            color: var(--panel-text-heading);
            margin: 0;
            font-size: 1.8em;
        }
        
        #info-panel h3 {
            font-family: var(--font-heading);
            border-bottom: 1px solid var(--panel-border);
            padding-bottom: 8px;
            margin-top: 25px;
            font-size: 1.2em;
            color: var(--panel-text-heading);
        }
        
        #info-panel .classification {
            font-style: italic;
            font-weight: 500;
            color: var(--panel-text);
            opacity: 0.7;
        }
        
        .tabs {
            display: flex;
            gap: 0.5em;
            margin-bottom: 1em;
            border-bottom: 1px solid var(--panel-border);
        }

        .tab-link {
            padding: 0.8em 1.2em;
            cursor: pointer;
            background: none;
            border: none;
            color: var(--panel-text);
            opacity: 0.6;
            font-family: var(--font-body);
            font-size: 1em;
            font-weight: 500;
            border-bottom: 3px solid transparent;
             transition: all 0.2s;
        }

        .tab-link.active, .tab-link:hover {
            color: var(--panel-text-heading);
            opacity: 1;
            border-bottom-color: var(--panel-accent-glow);
        }

        .tab-content { display: none; }
        .tab-content.active { display: block; }
        
        #info-code-snippet {
            background-color: rgba(0,0,0,0.3);
            color: #c9d1d9;
            padding: 1em;
            border-radius: 8px;
            white-space: pre-wrap;
            border: 1px solid var(--panel-border);
        }
        
        #info-diagram-img {
             width:100%; 
             border-radius: 8px; 
             background-color: #e0e5f0;
             border: 1px solid var(--panel-border);
        }

        #important-note {
            background-color: #fffbe6;
            border: 1px solid #ffe58f;
            border-radius: 8px;
            padding: 1.5em;
            margin: 2em auto;
            max-width: 90%;
        }
        #important-note h3 { margin-top: 0; }
        #important-note ul { padding-left: 20px; }

    </style>
</head>
<body>

<div class="app-container">
    <div id="important-note">
        <h3>⚠️ Nota Importante Antes de Empezar</h3>
        <ul>
            <li>La efectividad de un patrón depende del contexto real. No deben aplicarse indiscriminadamente, ya que pueden añadir complejidad innecesaria.</li>
            <li>Los patrones son guías flexibles, no soluciones fijas. Céntrate primero en los principios de diseño (SOLID, DRY, KISS, YAGNI) para entender el "porqué" de los patrones.</li>
            <li>Identificar y aplicar el patrón correcto se desarrolla con la experiencia y la práctica.</li>
        </ul>
    </div>
    
    <div id="tree-container">
        <svg class="connections-svg"></svg>
        
        <!-- Nivel 0: Inicio -->
        <div class="level" id="level-0">
            <div id="start" class="node node-problem">
                Problema de diseño a solucionar
            </div>
        </div>

        <!-- Nivel 1: Categoría -->
        <div class="level hidden" id="level-1">
             <div id="category-question" class="node node-question">
                ¿Qué tipo de problema de diseño estás enfrentando?
            </div>
            <div id="category-creational" class="node clickable" data-target="level-2-creational">Problema con la CREACIÓN de objetos</div>
            <div id="category-structural" class="node clickable" data-target="level-2-structural">Problema con la ESTRUCTURA de clases/objetos</div>
            <div id="category-behavioral" class="node clickable" data-target="level-2-behavioral">Problema con el COMPORTAMIENTO de objetos</div>
        </div>

        <!-- Nivel 2: Sub-ramificaciones -->
        <div class="level hidden" id="level-2-creational">
            <div class="node node-question">¿Necesitas crear objetos sin especificar sus clases concretas?</div>
            <div id="q-creational-family" class="node clickable" data-target="p-abstract-factory">Sí, necesito familias de objetos relacionados.</div>
            <div id="q-creational-subclass" class="node clickable" data-target="p-factory-method">Sí, quiero que las subclases decidan qué crear.</div>
            <div id="q-creational-clone" class="node clickable" data-target="p-prototype">Sí, quiero clonar un objeto existente.</div>
            <div class="node node-question">Otras opciones creacionales:</div>
            <div id="q-creational-builder" class="node clickable" data-target="p-builder">¿Construir un objeto complejo paso a paso?</div>
            <div id="q-creational-singleton" class="node clickable" data-target="p-singleton">¿Asegurar una única instancia global?</div>
        </div>
        
        <div class="level hidden" id="level-2-structural">
             <div class="node node-question">¿Cómo necesitas organizar clases/objetos?</div>
             <div id="q-structural-adapter" class="node clickable" data-target="p-adapter">Hacer que interfaces incompatibles trabajen juntas.</div>
             <div id="q-structural-bridge" class="node clickable" data-target="p-bridge">Separar abstracción de implementación.</div>
             <div id="q-structural-composite" class="node clickable" data-target="p-composite">Crear jerarquías de objetos parte-todo (árboles).</div>
             <div id="q-structural-decorator" class="node clickable" data-target="p-decorator">Añadir funcionalidad a un objeto dinámicamente.</div>
             <div id="q-structural-facade" class="node clickable" data-target="p-facade">Simplificar un subsistema complejo con una interfaz única.</div>
             <div id="q-structural-flyweight" class="node clickable" data-target="p-flyweight">Manejar muchos objetos finos eficientemente (compartiendo).</div>
             <div id="q-structural-proxy" class="node clickable" data-target="p-proxy">Controlar el acceso a un objeto (placeholder).</div>
        </div>

        <div class="level hidden" id="level-2-behavioral">
            <div class="node node-question">¿Cómo deben interactuar o comunicarse los objetos?</div>
            <div id="q-behavioral-chain" class="node clickable" data-target="p-chain-of-responsibility">Pasar una petición por una cadena de objetos.</div>
            <div id="q-behavioral-command" class="node clickable" data-target="p-command">Encapsular una petición como un objeto.</div>
            <div id="q-behavioral-iterator" class="node clickable" data-target="p-iterator">Acceder a elementos de una colección secuencialmente.</div>
            <div id="q-behavioral-mediator" class="node clickable" data-target="p-mediator">Centralizar la comunicación entre un conjunto de objetos.</div>
            <div id="q-behavioral-memento" class="node clickable" data-target="p-memento">Guardar y restaurar el estado de un objeto.</div>
            <div id="q-behavioral-observer" class="node clickable" data-target="p-observer">Notificar a muchos objetos sobre un cambio de estado.</div>
            <div id="q-behavioral-state" class="node clickable" data-target="p-state">Alterar el comportamiento de un objeto cuando su estado cambia.</div>
            <div id="q-behavioral-strategy" class="node clickable" data-target="p-strategy">Hacer algoritmos intercambiables.</div>
            <div id="q-behavioral-template" class="node clickable" data-target="p-template-method">Definir el esqueleto de un algoritmo en una superclase.</div>
            <div id="q-behavioral-visitor" class="node clickable" data-target="p-visitor">Añadir nuevas operaciones a clases existentes sin modificarlas.</div>
        </div>
        
        <!-- Nivel 3: Patrones Finales -->
        <div class="level hidden" id="level-3">
             <div id="q-abstract-factory" class="node node-question hidden">¿Necesitas crear familias de objetos relacionados sin especificar sus clases concretas?</div>
             <div id="p-abstract-factory" data-parent="q-abstract-factory" class="node node-pattern clickable hidden"><span>Abstract Factory</span><a href="#" class="code-link" data-pattern-id="p-abstract-factory">Ver Código</a></div>
             <div id="p-factory-method" class="node node-pattern clickable hidden"><span>Factory Method</span><a href="#" class="code-link" data-pattern-id="p-factory-method">Ver Código</a></div>
             <div id="p-prototype" class="node node-pattern clickable hidden"><span>Prototype</span><a href="#" class="code-link" data-pattern-id="p-prototype">Ver Código</a></div>
             <div id="p-builder" class="node node-pattern clickable hidden"><span>Builder</span><a href="#" class="code-link" data-pattern-id="p-builder">Ver Código</a></div>
             <div id="p-singleton" class="node node-pattern clickable hidden"><span>Singleton</span><a href="#" class="code-link" data-pattern-id="p-singleton">Ver Código</a></div>
             <div id="p-adapter" class="node node-pattern clickable hidden"><span>Adapter</span><a href="#" class="code-link" data-pattern-id="p-adapter">Ver Código</a></div>
             <div id="p-bridge" class="node node-pattern clickable hidden"><span>Bridge</span><a href="#" class="code-link" data-pattern-id="p-bridge">Ver Código</a></div>
             <div id="p-composite" class="node node-pattern clickable hidden"><span>Composite</span><a href="#" class="code-link" data-pattern-id="p-composite">Ver Código</a></div>
             <div id="p-decorator" class="node node-pattern clickable hidden"><span>Decorator</span><a href="#" class="code-link" data-pattern-id="p-decorator">Ver Código</a></div>
             <div id="p-facade" class="node node-pattern clickable hidden"><span>Facade</span><a href="#" class="code-link" data-pattern-id="p-facade">Ver Código</a></div>
             <div id="p-flyweight" class="node node-pattern clickable hidden"><span>Flyweight</span><a href="#" class="code-link" data-pattern-id="p-flyweight">Ver Código</a></div>
             <div id="p-proxy" class="node node-pattern clickable hidden"><span>Proxy</span><a href="#" class="code-link" data-pattern-id="p-proxy">Ver Código</a></div>
             <div id="p-chain-of-responsibility" class="node node-pattern clickable hidden"><span>Chain of Responsibility</span><a href="#" class="code-link" data-pattern-id="p-chain-of-responsibility">Ver Código</a></div>
             <div id="p-command" class="node node-pattern clickable hidden"><span>Command</span><a href="#" class="code-link" data-pattern-id="p-command">Ver Código</a></div>
             <div id="p-iterator" class="node node-pattern clickable hidden"><span>Iterator</span><a href="#" class="code-link" data-pattern-id="p-iterator">Ver Código</a></div>
             <div id="p-mediator" class="node node-pattern clickable hidden"><span>Mediator</span><a href="#" class="code-link" data-pattern-id="p-mediator">Ver Código</a></div>
             <div id="p-memento" class="node node-pattern clickable hidden"><span>Memento</span><a href="#" class="code-link" data-pattern-id="p-memento">Ver Código</a></div>
             <div id="p-observer" class="node node-pattern clickable hidden"><span>Observer</span><a href="#" class="code-link" data-pattern-id="p-observer">Ver Código</a></div>
             <div id="p-state" class="node node-pattern clickable hidden"><span>State</span><a href="#" class="code-link" data-pattern-id="p-state">Ver Código</a></div>
             <div id="p-strategy" class="node node-pattern clickable hidden"><span>Strategy</span><a href="#" class="code-link" data-pattern-id="p-strategy">Ver Código</a></div>
             <div id="p-template-method" class="node node-pattern clickable hidden"><span>Template Method</span><a href="#" class="code-link" data-pattern-id="p-template-method">Ver Código</a></div>
             <div id="p-visitor" class="node node-pattern clickable hidden"><span>Visitor</span><a href="#" class="code-link" data-pattern-id="p-visitor">Ver Código</a></div>
        </div>
    </div>
</div>

<div id="info-panel" class="hidden">
    <button id="info-panel-close">&times;</button>
    <div class="panel-header">
        <div id="info-icon-container"></div>
        <div>
            <h2 id="info-title"></h2>
            <p id="info-classification" class="classification"></p>
        </div>
    </div>
    
    <h3>Concepto General</h3>
    <p>Un patrón de diseño es una solución probada y generalizable a un problema recurrente de diseño de software. Funcionan como 'planos prefabricados' que se pueden personalizar para tu código. Su importancia radica en que ahorran tiempo, garantizan la validez del código y crean un lenguaje común entre desarrolladores.</p>
    
    <h3>Problema Específico que Resuelve</h3>
    <p id="info-problem"></p>
    
    <h3>Por Qué Seleccionarlo (Ventajas)</h3>
    <p id="info-advantages"></p>
    
    <h3>Consideraciones Adicionales (Desventajas)</h3>
    <p id="info-disadvantages"></p>

    <h3>Aplicación Común</h3>
    <p id="info-usage"></p>

    <h3 id="info-principle-title" class="hidden">Principio Clave Relacionado</h3>
    <p id="info-principle" class="hidden"></p>

    <h3>Implementación de Ejemplo</h3>
    <div class="tabs">
        <button class="tab-link active" data-tab="diagram-content">Diagrama de Clases</button>
        <button class="tab-link" data-tab="code-content">Código de Ejemplo (Java)</button>
    </div>
    <div id="diagram-content" class="tab-content active">
        <img id="info-diagram-img" src="" alt="Diagrama de Clases">
    </div>
    <div id="code-content" class="tab-content">
        <pre><code id="info-code-snippet"></code></pre>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    // --- DATA STORE ---
    const patternData = {
        'p-abstract-factory': {
            title: 'Abstract Factory', classification: 'Creacional',
            problem: 'Proporciona una interfaz para crear familias de objetos relacionados o que dependen entre sí, sin especificar sus clases concretas.',
            advantages: 'Asegura la consistencia entre los productos de una misma familia. Oculta las clases concretas de los clientes, dando flexibilidad a lo que se crea y cuándo.',
            disadvantages: 'Añadir nuevos tipos de productos es difícil, ya que requiere extender la fábrica abstracta y todas sus subclases.',
            usage: 'Crear UIs para diferentes sistemas operativos (Windows, macOS), donde cada familia de widgets (botones, ventanas) debe ser consistente.',
            principle: 'Principio de Abierto/Cerrado.',
            diagram: 'https://placehold.co/600x350/e0e5f0/333?text=Diagrama+Abstract+Factory',
            code: `// Interfaces abstractas\ninterface Button { void paint(); }\ninterface GUIFactory { Button createButton(); }\n\n// Implementaciones para Windows\nclass WinButton implements Button { public void paint() { System.out.println("Renderizando botón de Windows."); } }\nclass WinFactory implements GUIFactory { public Button createButton() { return new WinButton(); } }\n\n// Implementaciones para macOS\nclass MacButton implements Button { public void paint() { System.out.println("Renderizando botón de macOS."); } }\nclass MacFactory implements GUIFactory { public Button createButton() { return new MacButton(); } }\n\n// Cliente\nclass Application {\n    private Button button;\n    public Application(GUIFactory factory) {\n        button = factory.createButton();\n    }\n    public void paint() { button.paint(); }\n}`,
            icon: `<svg viewBox="0 0 24 24" fill="none" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2L12 8"></path><path d="M12 16L12 22"></path><path d="M17 12L22 12"></path><path d="M2 12L8 12"></path><path d="M12 12L12 12"></path><circle cx="12" cy="12" r="4"></circle><path d="M4.929 4.929L8.464 8.464"></path><path d="M15.536 15.536L19.071 19.071"></path><path d="M4.929 19.071L8.464 15.536"></path><path d="M15.536 8.464L19.071 4.929"></path></svg>`
        },
        'p-factory-method': {
            title: 'Factory Method', classification: 'Creacional',
            problem: 'Permite que una clase delegue la instanciación de sus objetos en sus subclases, definiendo una interfaz para crear un objeto pero dejando que sean las subclases quienes decidan qué clase concreta instanciar.',
            advantages: 'Permite introducir nuevos tipos de productos sin romper el código cliente existente. Proporciona hooks para las subclases y conecta jerarquías de clases paralelas.',
            disadvantages: 'Puede llevar a una jerarquía de clases paralela y compleja si hay muchos productos.',
            usage: 'En un framework, para permitir que el código de usuario extienda sus componentes internos.',
            principle: 'Principio de Inversión de Dependencias.',
            diagram: 'https://placehold.co/600x350/e0e5f0/333?text=Diagrama+Factory+Method',
            code: `// Producto\ninterface Transport { void deliver(); }\nclass Truck implements Transport { public void deliver() { System.out.println("Entregar por tierra en un camión."); } }\nclass Ship implements Transport { public void deliver() { System.out.println("Entregar por mar en un barco."); } }\n\n// Creador (con el Factory Method)\nabstract class Logistics {\n    public abstract Transport createTransport();\n    public void planDelivery() {\n        Transport t = createTransport();\n        t.deliver();\n    }\n}\n\n// Creadores Concretos\nclass RoadLogistics extends Logistics { public Transport createTransport() { return new Truck(); } }\nclass SeaLogistics extends Logistics { public Transport createTransport() { return new Ship(); } }`,
            icon: `<svg viewBox="0 0 24 24" fill="none" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M2 8.5h11.5"></path><path d="M6 16.5h11.5"></path><path d="M6 12.5h7.5"></path><path d="M17.5 16.5l3-4-3-4"></path><path d="M2 12.5l3 4-3 4"></path></svg>`
        },
         'p-builder': {
            title: 'Builder', classification: 'Creacional',
            problem: 'Necesitas construir un objeto complejo paso a paso, permitiendo diferentes representaciones del mismo objeto con el mismo proceso de construcción.',
            advantages: 'Permite variar la representación interna de un producto. Encapsula el código de construcción y representación. Proporciona un control más detallado sobre el proceso de construcción.',
            disadvantages: 'Requiere crear un Builder concreto para cada tipo diferente de producto, lo que puede aumentar el número de clases.',
            usage: 'Crear un objeto `Query` para una base de datos, donde se añaden cláusulas (`select`, `where`, `orderBy`) paso a paso.',
            diagram: 'https://placehold.co/600x350/e0e5f0/333?text=Diagrama+Builder',
            code: `// Producto complejo\nclass House {\n    private int walls; private int doors; private int windows;\n    // ... setters y toString ...\n}\n\n// Builder\ninterface HouseBuilder {\n    void buildWalls();\n    void buildDoors();\n    void buildWindows();\n    House getResult();\n}\n\n// Builder Concreto\nclass ConcreteHouseBuilder implements HouseBuilder {\n    private House house = new House();\n    public void buildWalls() { house.setWalls(4); }\n    public void buildDoors() { house.setDoors(1); }\n    public void buildWindows() { house.setWindows(2); }\n    public House getResult() { return house; }\n}`,
            icon: `<svg viewBox="0 0 24 24" fill="none" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="11" width="18" height="10" rx="2"></rect><path d="M3 11V7a2 2 0 012-2h4"></path><path d="M12 5h2a2 2 0 012 2v4"></path><path d="M10 5L10 5"></path><path d="M14 5L14 5"></path><path d="M9 16h6"></path></svg>`
        },
        'p-singleton': {
            title: 'Singleton', classification: 'Creacional',
            problem: 'Necesitas asegurar que una clase tenga solo una instancia y proporcionar un punto de acceso global a ella.',
            advantages: 'Garantiza una única instancia. El acceso a ella está controlado y es fácil de localizar.',
            disadvantages: 'Puede aumentar la complejidad de la implementación (especialmente en entornos multihilo) y dificultar las pruebas al introducir un estado global.',
            usage: 'Gestores de logs, drivers de bases de datos, o un objeto de configuración que debe ser único en la aplicación.',
            diagram: 'https://placehold.co/600x350/e0e5f0/333?text=Diagrama+Singleton',
            code: `public final class Database {\n    private static volatile Database instance;\n\n    private Database() {}\n\n    public static Database getInstance() {\n        if (instance == null) {\n            synchronized (Database.class) {\n                if (instance == null) {\n                    instance = new Database();\n                }\n            }\n        }\n        return instance;\n    }\n}`,
            icon: `<svg viewBox="0 0 24 24" fill="none" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2z"></path><path d="M12 6v6l4 2"></path><path d="M10 1h4"></path><path d="M10 23h4"></path><path d="M23 10v4"></path><path d="M1 10v4"></path></svg>`
        },
        'p-prototype': {
            title: 'Prototype', classification: 'Creacional',
            problem: 'Necesitas crear objetos mediante un "molde" o una "plantilla", clonando instancias existentes.',
            advantages: 'Permite añadir y eliminar productos en tiempo de ejecución. Evita la sobrecarga de crear un objeto desde cero y puede ser más eficiente.',
            disadvantages: 'Clonar objetos complejos con referencias circulares puede ser muy complicado.',
            usage: 'En un juego, para clonar enemigos con configuraciones predefinidas en lugar de crear cada uno desde cero.',
            diagram: 'https://placehold.co/600x350/e0e5f0/333?text=Diagrama+Prototype',
            code: `// Interfaz del prototipo\ninterface Shape extends Cloneable {\n    Shape clone();\n}\n\n// Prototipo concreto\nclass Sheep implements Shape {\n    private String name;\n    public Sheep(String name) { this.name = name; }\n\n    @Override\n    public Shape clone() {\n        try {\n            return (Shape) super.clone();\n        } catch (CloneNotSupportedException e) { return null; }\n    }\n}`,
            icon: `<svg viewBox="0 0 24 24" fill="none" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2.5C12 2.5 10 2.5 8.5 4.5S6.5 9.5 8 11s3 1.5 4 0 2-4.5 2-4.5"></path><path d="M12 2.5C12 2.5 14 2.5 15.5 4.5S17.5 9.5 16 11s-3 1.5-4 0"></path><path d="M12 11v10.5"></path><path d="M12 21.5L9.5 19"></path><path d="M12 21.5L14.5 19"></path></svg>`
        },
        'p-adapter': {
            title: 'Adapter', classification: 'Estructural',
            problem: 'Necesitas hacer que clases con interfaces incompatibles trabajen juntas, envolviendo un objeto para darle una nueva interfaz.',
            advantages: 'Permite que clases que no podrían trabajar juntas lo hagan. Aumenta la reutilización de clases existentes.',
            disadvantages: 'Añade una capa extra de indirección, lo que puede complicar ligeramente el código.',
            usage: 'Envolver una API externa (ej. un servicio de pagos) para que se ajuste a la interfaz que espera nuestra aplicación.',
            diagram: 'https://placehold.co/600x350/e0e5f0/333?text=Diagrama+Adapter',
            code: `// Interfaz esperada por el cliente (Target)\ninterface EuropeanSocket { String getPower(); }\n\n// Clase con interfaz incompatible (Adaptee)\nclass AmericanPlug { public String getVoltage() { return "120V"; } }\n\n// Adaptador\nclass SocketAdapter implements EuropeanSocket {\n    private AmericanPlug plug;\n    public SocketAdapter(AmericanPlug plug) { this.plug = plug; }\n\n    @Override\n    public String getPower() {\n        // Adaptación de 120V a 220V (conceptual)\n        return plug.getVoltage().replace("120", "220");\n    }\n}`,
            icon: `<svg viewBox="0 0 24 24" fill="none" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M8 8h8v8H8z"></path><path d="M4 12h4"></path><path d="M16 12h4"></path><path d="M12 4v4"></path><path d="M12 16v4"></path><circle cx="12" cy="12" r="2"></circle></svg>`
        },
        'p-bridge': {
            title: 'Bridge', classification: 'Estructural',
            problem: 'Necesitas separar una abstracción de su implementación, permitiendo que ambas evolucionen de forma independiente.',
            advantages: 'Desacopla la interfaz de la implementación. Mejora la extensibilidad; se pueden extender la abstracción y la implementación de forma independiente.',
            disadvantages: 'Puede aumentar la complejidad del código al introducir más clases e interfaces.',
            usage: 'Una aplicación de dibujo con diferentes formas (círculo, cuadrado) que deben poder dibujarse en diferentes APIs gráficas (Windows API, OpenGL).',
            diagram: 'https://placehold.co/600x350/e0e5f0/333?text=Diagrama+Bridge',
            code: `// Implementador\ninterface DrawingAPI { void drawCircle(double x, double y, double radius); }\nclass DrawingAPI1 implements DrawingAPI { /* ... */ }\nclass DrawingAPI2 implements DrawingAPI { /* ... */ }\n\n// Abstracción\nabstract class Shape {\n    protected DrawingAPI drawingAPI;\n    protected Shape(DrawingAPI drawingAPI){ this.drawingAPI = drawingAPI; }\n    public abstract void draw();\n}\n\n// Abstracción Refinada\nclass CircleShape extends Shape {\n    private double x, y, radius;\n    public CircleShape(double x, double y, double radius, DrawingAPI drawingAPI) {\n        super(drawingAPI);\n        this.x = x; this.y = y; this.radius = radius;\n    }\n    public void draw() { drawingAPI.drawCircle(x, y, radius); }\n}`,
            icon: `<svg viewBox="0 0 24 24" fill="none" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M2 12h20"></path><path d="M5 12V7a2 2 0 012-2h10a2 2 0 012 2v5"></path><path d="M5 12v6a2 2 0 002 2h10a2 2 0 002-2v-6"></path></svg>`
        },
        'p-composite': {
            title: 'Composite', classification: 'Estructural',
            problem: 'Necesitas componer objetos en estructuras de árbol para representar jerarquías de parte-todo, tratando los objetos individuales y compuestos de manera uniforme.',
            advantages: 'Simplifica el código del cliente, ya que no necesita distinguir entre objetos simples y compuestos. Facilita añadir nuevos tipos de componentes.',
            disadvantages: 'Puede hacer que el diseño sea demasiado general. Es más difícil restringir los componentes de un compuesto.',
            usage: 'Representar un sistema de archivos, donde tanto los archivos (hojas) como los directorios (compuestos) pueden ser tratados con las mismas operaciones (ej. `getSize()`).',
            diagram: 'https://placehold.co/600x350/e0e5f0/333?text=Diagrama+Composite',
            code: `// Componente\ninterface FileSystemComponent { int getSize(); }\n\n// Hoja (Leaf)\nclass File implements FileSystemComponent {\n    private int size;\n    public int getSize() { return size; }\n}\n\n// Compuesto (Composite)\nclass Directory implements FileSystemComponent {\n    private List<FileSystemComponent> children = new ArrayList<>();\n    public void add(FileSystemComponent component) { children.add(component); }\n    public int getSize() {\n        return children.stream().mapToInt(FileSystemComponent::getSize).sum();\n    }\n}`,
            icon: `<svg viewBox="0 0 24 24" fill="none" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2v5"></path><path d="M12 17v5"></path><path d="M12 7h7l-3 5 3 5h-7"></path><path d="M12 7H5l3 5-3 5h7"></path></svg>`
        },
        'p-decorator': {
            title: 'Decorator', classification: 'Estructural',
            problem: 'Necesitas añadir responsabilidades adicionales a un objeto dinámicamente, como una alternativa flexible a la herencia.',
            advantages: 'Proporciona más flexibilidad que la herencia estática. Evita la explosión de subclases para cada combinación de características.',
            disadvantages: 'Puede llevar a la creación de un gran número de objetos pequeños si se añaden muchas responsabilidades, incrementando la complejidad.',
            usage: 'En Java I/O, `FileInputStream` puede ser "decorado" con `BufferedInputStream` para añadir buffering.',
            diagram: 'https://placehold.co/600x350/e0e5f0/333?text=Diagrama+Decorator',
            code: `// Componente\ninterface Coffee { String getDescription(); double getCost(); }\n\n// Componente Concreto\nclass SimpleCoffee implements Coffee { public String getDescription() { return "Café simple"; } public double getCost() { return 1.0; } }\n\n// Decorador Base\nabstract class CoffeeDecorator implements Coffee {\n    protected final Coffee decoratedCoffee;\n    public CoffeeDecorator(Coffee c) { this.decoratedCoffee = c; }\n    public String getDescription() { return decoratedCoffee.getDescription(); }\n    public double getCost() { return decoratedCoffee.getCost(); }\n}\n\n// Decorador Concreto\nclass WithMilk extends CoffeeDecorator {\n    public WithMilk(Coffee c) { super(c); }\n    public String getDescription() { return super.getDescription() + ", con leche"; }\n    public double getCost() { return super.getCost() + 0.5; }\n}`,
            icon: `<svg viewBox="0 0 24 24" fill="none" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="7"></circle><path d="M12 2v2"></path><path d="M12 20v2"></path><path d="M4.93 4.93l1.41 1.41"></path><path d="M17.66 17.66l1.41 1.41"></path><path d="M2 12h2"></path><path d="M20 12h2"></path><path d="M4.93 19.07l1.41-1.41"></path><path d="M17.66 6.34l1.41-1.41"></path></svg>`
        },
        'p-facade': {
            title: 'Facade', classification: 'Estructural',
            problem: 'Necesitas proporcionar una interfaz unificada y simplificada a un conjunto complejo de interfaces en un subsistema.',
            advantages: 'Desacopla a los clientes del subsistema, facilitando su uso y reduciendo las dependencias. Promueve la organización en capas.',
            disadvantages: 'Una Facade puede convertirse en un "god object" si se le da demasiada responsabilidad.',
            usage: 'Crear una clase `VideoConverter` que oculte la complejidad de librerías de audio, video y códecs.',
            diagram: 'https://placehold.co/600x350/e0e5f0/333?text=Diagrama+Facade',
            code: `// Subsistema complejo\nclass CPU { public void freeze() { /* ... */ } public void execute() { /* ... */ } }\nclass Memory { public void load(long position, byte[] data) { /* ... */ } }\nclass HardDrive { public byte[] read(long lba, int size) { /* ... */ } }\n\n// Fachada (Facade)\nclass ComputerFacade {\n    private CPU processor; private Memory ram;\n    public ComputerFacade() { /* inicializa subsistemas */ }\n    public void start() {\n        processor.freeze();\n        ram.load(0, HardDrive.read(0, 1024));\n        processor.execute();\n    }\n}`,
            icon: `<svg viewBox="0 0 24 24" fill="none" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M4 7V5a2 2 0 012-2h12a2 2 0 012 2v14a2 2 0 01-2 2h-4"></path><path d="M8 7H4v4"></path><path d="M12 12h-1v-1"></path><path d="M15 15h-1v-1"></path><path d="M9 9h-1v-1"></path><path d="M4 4L20 20"></path></svg>`
        },
        'p-flyweight': {
            title: 'Flyweight', classification: 'Estructural',
            problem: 'Necesitas manejar un gran número de objetos de grano fino de manera eficiente, compartiendo un único objeto pesado para ahorrar memoria.',
            advantages: 'Reduce drásticamente el número de objetos y el consumo de memoria cuando hay muchos objetos similares.',
            disadvantages: 'Puede aumentar la complejidad del código al tener que separar el estado intrínseco (compartido) del extrínseco (no compartido).',
            usage: 'En un editor de texto, para representar caracteres. Cada letra (A, B, C) es un flyweight compartido, mientras que su posición y formato son estado extrínseco.',
            diagram: 'https://placehold.co/600x350/e0e5f0/333?text=Diagrama+Flyweight',
            code: `// Flyweight\nclass CharacterStyle { /* estado intrínseco: font, size, color */ }\n\n// Fábrica de Flyweights\nclass StyleFactory {\n    private Map<String, CharacterStyle> styles = new HashMap<>();\n    public CharacterStyle getStyle(String key) {\n        // Reusa o crea un nuevo estilo\n        return styles.computeIfAbsent(key, k -> new CharacterStyle());\n    }\n}\n\n// Contexto (usa el Flyweight)\nclass Character {\n    private char character; // estado extrínseco\n    private CharacterStyle style; // referencia al flyweight\n}`,
            icon: `<svg viewBox="0 0 24 24" fill="none" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2v10"></path><path d="M12 12l-4-4"></path><path d="M12 12l4-4"></path><path d="M5 12h14"></path><path d="M5 12c0 5 2 8 7 8s7-3 7-8"></path></svg>`
        },
        'p-proxy': {
            title: 'Proxy', classification: 'Estructural',
            problem: 'Necesitas proporcionar un sustituto o "placeholder" para otro objeto para controlar el acceso a él.',
            advantages: 'Puede realizar optimizaciones (carga diferida), añadir seguridad (control de acceso) o gestionar la comunicación remota sin que el cliente lo sepa.',
            disadvantages: 'Añade una capa de indirección que puede afectar el rendimiento si no se gestiona bien.',
            usage: 'Proxy virtual para cargar imágenes pesadas solo cuando son visibles. Proxy de protección para restringir el acceso a ciertas operaciones.',
            diagram: 'https://placehold.co/600x350/e0e5f0/333?text=Diagrama+Proxy',
            code: `// Sujeto\ninterface Image { void display(); }\n\n// Sujeto Real\nclass RealImage implements Image {\n    private String filename;\n    public RealImage(String filename) { this.filename = filename; loadFromDisk(); }\n    private void loadFromDisk() { /* ... carga pesada ... */ }\n    public void display() { System.out.println("Displaying " + filename); }\n}\n\n// Proxy\nclass ProxyImage implements Image {\n    private RealImage realImage;\n    private String filename;\n    public ProxyImage(String filename) { this.filename = filename; }\n    public void display() {\n        if (realImage == null) {\n            realImage = new RealImage(filename);\n        }\n        realImage.display();\n    }\n}`,
            icon: `<svg viewBox="0 0 24 24" fill="none" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"></circle><path d="M12 16.5A4.5 4.5 0 007.5 12 4.5 4.5 0 0012 7.5"></path><path d="M12 7.5A4.5 4.5 0 0116.5 12 4.5 4.5 0 0112 16.5"></path><path d="M12 16.5a4.5 4.5 0 004.5-4.5"></path><path d="M12 7.5a4.5 4.5 0 00-4.5 4.5"></path><path d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>`
        },
        'p-observer': {
            title: 'Observer', classification: 'De Comportamiento',
            problem: 'Define una dependencia de uno a muchos entre objetos, de manera que cuando un objeto (sujeto) cambia de estado, todos sus dependientes (observadores) son notificados y actualizados automáticamente.',
            advantages: 'Permite modificar sujetos y observadores de forma independiente. Reduce el acoplamiento y permite notificar a otros objetos sin hacer suposiciones sobre ellos.',
            disadvantages: 'Las actualizaciones pueden ser inesperadas y en orden no determinístico. Puede causar fugas de memoria si los observadores no se eliminan correctamente ("lapsed listener problem").',
            usage: 'En una hoja de cálculo, cuando el valor de una celda cambia (sujeto), las celdas que dependen de ella (observadores) se recalculan.',
            principle: 'Principio de Inversión de Dependencias.',
            diagram: 'https://placehold.co/600x350/e0e5f0/333?text=Diagrama+Observer',
            code: `// Sujeto (Publisher)\nclass Editor {\n    public EventManager events = new EventManager("open", "save");\n    public void openFile(String path) { events.notify("open", path); }\n}\n\n// Observador (Listener)\ninterface EventListener { void update(String eventType, String data); }\n\n// Observador Concreto\nclass LoggingListener implements EventListener {\n    public void update(String eventType, String data) {\n        System.out.println("Log: " + eventType + " - " + data);\n    }\n}\n\n// Gestor de eventos del Sujeto\nclass EventManager { /* ... lógica para suscribir y notificar ... */ }`,
            icon: `<svg viewBox="0 0 24 24" fill="none" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="2"></circle><path d="M12 4V2"></path><path d="M12 22v-2"></path><path d="M20 12h2"></path><path d="M2 12H4"></path><path d="M19.07 4.93l1.41-1.41"></path><path d="M3.51 20.49l1.42-1.42"></path><path d="M19.07 19.07l1.41 1.41"></path><path d="M3.51 3.51l1.42 1.42"></path></svg>`
        },
         'p-chain-of-responsibility': {
            title: 'Chain of Responsibility', classification: 'De Comportamiento',
            problem: 'Necesitas manejar una petición por múltiples objetos en una cadena, sin especificar explícitamente el receptor. La petición pasa por la cadena hasta que un objeto la maneja.',
            advantages: 'Reduce el acoplamiento entre el emisor y los receptores. Simplifica el objeto emisor. Ofrece flexibilidad para asignar responsabilidades a los objetos.',
            disadvantages: 'No se garantiza que una petición sea manejada. Puede ser difícil de depurar si la cadena es larga o se configura incorrectamente.',
            usage: 'En un sistema de logging con diferentes niveles (DEBUG, INFO, ERROR). Un mensaje pasa por la cadena hasta que encuentra un logger configurado para su nivel o superior.',
            diagram: 'https://placehold.co/600x350/e0e5f0/333?text=Diagrama+Chain+of+Responsibility',
            code: `// Handler\ninterface Handler { Handler setNext(Handler handler); void handle(String request); }\n\n// Handler Base Abstracto\nabstract class AbstractHandler implements Handler {\n    private Handler nextHandler;\n    public Handler setNext(Handler handler) { this.nextHandler = handler; return handler; }\n    public void handle(String request) {\n        if (nextHandler != null) { nextHandler.handle(request); }\n    }\n}\n\n// Handlers Concretos\nclass AdminAuthHandler extends AbstractHandler { /* ... */ }\nclass UserAuthHandler extends AbstractHandler { /* ... */ }`,
            icon: `<svg viewBox="0 0 24 24" fill="none" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M8.5 10.5h7"></path><path d="M8.5 13.5h7"></path><rect x="4" y="4" width="16" height="16" rx="2"></rect><path d="M2 12h2"></path><path d="M20 12h2"></path></svg>`
        },
        'p-command': {
            title: 'Command', classification: 'De Comportamiento',
            problem: 'Necesitas encapsular una petición como un objeto. Esto permite parametrizar clientes con diferentes peticiones, encolarlas, registrarlas y soportar operaciones de deshacer.',
            advantages: 'Desacopla el objeto que invoca la operación del que sabe cómo realizarla. Facilita la implementación de deshacer/rehacer y la creación de macros.',
            disadvantages: 'Puede resultar en un gran número de clases Command pequeñas, aumentando la complejidad del sistema.',
            usage: 'Implementar las acciones de un menú en un editor de texto (Copiar, Pegar, Cortar), donde cada acción es un objeto Command que se puede deshacer.',
            diagram: 'https://placehold.co/600x350/e0e5f0/333?text=Diagrama+Command',
            code: `// Comando\ninterface Command { void execute(); }\n\n// Receptor\nclass Light { public void turnOn() { /* ... */ } public void turnOff() { /* ... */ } }\n\n// Comandos Concretos\nclass TurnOnCommand implements Command {\n    private Light light; public TurnOnCommand(Light l) {this.light = l;}\n    public void execute() { light.turnOn(); }\n}\n\n// Invocador\nclass RemoteControl { \n    private Command command;\n    public void setCommand(Command c) { this.command = c; }\n    public void pressButton() { command.execute(); }\n}`,
            icon: `<svg viewBox="0 0 24 24" fill="none" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2"></rect><path d="M7 8h10"></path><path d="M7 12h10"></path><path d="M7 16h5"></path></svg>`
        },
        'p-iterator': {
            title: 'Iterator', classification: 'De Comportamiento',
            problem: 'Necesitas proporcionar una forma de acceder a los elementos de un objeto agregado (una colección) secuencialmente sin exponer su representación subyacente.',
            advantages: 'Permite variar la implementación de la colección sin afectar el código cliente. Simplifica la interfaz de la colección. Se pueden tener múltiples recorridos sobre la misma colección.',
            disadvantages: 'Para colecciones simples, un iterador puede ser una sobrecarga innecesaria.',
            usage: 'En todos los lenguajes de programación modernos para recorrer listas, arrays, mapas, etc., usando bucles como `for-each`.',
            diagram: 'https://placehold.co/600x350/e0e5f0/333?text=Diagrama+Iterator',
            code: `import java.util.Iterator;\nimport java.util.ArrayList;\n\n// El patrón ya está implementado en las colecciones de Java.\n// Así es como se usa:\nArrayList<String> items = new ArrayList<>();\nitems.add("Primero");\nitems.add("Segundo");\nitems.add("Tercero");\n\nIterator<String> it = items.iterator();\nwhile(it.hasNext()) {\n    System.out.println(it.next());\n}`,
            icon: `<svg viewBox="0 0 24 24" fill="none" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line><path d="M7 11h8"></path></svg>`
        },
        'p-mediator': {
            title: 'Mediator', classification: 'De Comportamiento',
            problem: 'Necesitas definir un objeto que encapsule cómo un conjunto de objetos interactúa. Centraliza la comunicación para reducir el acoplamiento directo entre ellos.',
            advantages: 'Reduce las subclases. Desacopla a los colegas. Simplifica los protocolos entre objetos. Centraliza el control.',
            disadvantages: 'El mediador puede convertirse en un "god object", volviéndose muy complejo y difícil de mantener.',
            usage: 'En una GUI, un diálogo que gestiona la interacción entre varios widgets (botones, checkboxes, campos de texto).',
            diagram: 'https://placehold.co/600x350/e0e5f0/333?text=Diagrama+Mediator',
            code: `// Mediador\ninterface Mediator { void notify(Component sender, String event); }\n\n// Componente (Colega)\nabstract class Component { protected Mediator dialog; }\nclass Button extends Component { public void click() { dialog.notify(this, "click"); } }\nclass Textbox extends Component { public void keypress() { dialog.notify(this, "keypress"); } }\n\n// Mediador Concreto\nclass AuthenticationDialog implements Mediator {\n    // ... tiene referencias a los colegas ...\n    public void notify(Component sender, String event) {\n        if (sender instanceof Button && event.equals("click")) {\n            System.out.println("Mediador reacciona al click del botón.");\n        }\n    }\n}`,
            icon: `<svg viewBox="0 0 24 24" fill="none" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"></circle><path d="M12 2v2"></path><path d="M12 20v2"></path><path d="M22 12h-2"></path><path d="M4 12H2"></path><path d="M19.07 4.93l-1.41 1.41"></path><path d="M6.34 17.66l-1.41 1.41"></path><path d="M19.07 19.07l-1.41-1.41"></path><path d="M6.34 6.34l-1.41-1.41"></path></svg>`
        },
        'p-memento': {
            title: 'Memento', classification: 'De Comportamiento',
            problem: 'Necesitas capturar y externalizar el estado interno de un objeto para que pueda ser restaurado posteriormente, sin violar la encapsulación.',
            advantages: 'Preserva la encapsulación, ya que el estado se guarda sin exponer los detalles internos del objeto. Simplifica el objeto originador.',
            disadvantages: 'Puede ser costoso en términos de memoria si los objetos tienen mucho estado o si se guardan muchos mementos.',
            usage: 'Implementar la funcionalidad de "Guardar Partida" en un juego o la de "Deshacer" en un editor.',
            diagram: 'https://placehold.co/600x350/e0e5f0/333?text=Diagrama+Memento',
            code: `// Memento\nclass Memento {\n    private final String state;\n    public Memento(String state) { this.state = state; }\n    public String getState() { return state; }\n}\n\n// Originador\nclass Editor {\n    private String content;\n    public void setContent(String c) { this.content = c; }\n    public Memento save() { return new Memento(this.content); }\n    public void restore(Memento m) { this.content = m.getState(); }\n}\n\n// Cuidador (Caretaker)\nclass History {\n    private Stack<Memento> mementos = new Stack<>();\n    public void push(Memento m) { mementos.push(m); }\n    public Memento pop() { return mementos.pop(); }\n}`,
            icon: `<svg viewBox="0 0 24 24" fill="none" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M3 3h18v18H3z"></path><path d="M12 16v-6"></path><path d="M9 13l3-3 3 3"></path><path d="M12 8V7"></path></svg>`
        },
        'p-state': {
            title: 'State', classification: 'De Comportamiento',
            problem: 'Necesitas permitir que un objeto altere su comportamiento cuando su estado interno cambia, de modo que parezca cambiar su clase.',
            advantages: 'Localiza el comportamiento específico de cada estado en objetos separados. Hace las transiciones de estado explícitas.',
            disadvantages: 'Puede resultar en un gran número de clases si hay muchos estados.',
            usage: 'Modelar una máquina de estados, como el comportamiento de una conexión de red (Abriendo, Escuchando, Cerrada) o un reproductor de música (Reproduciendo, Pausado, Detenido).',
            diagram: 'https://placehold.co/600x350/e0e5f0/333?text=Diagrama+State',
            code: `// Contexto\nclass TrafficLight {\n    private State state;\n    public TrafficLight() { this.state = new RedState(this); } // Estado inicial\n    public void changeState(State state) { this.state = state; }\n    public void show() { state.handle(); }\n}\n\n// Estado\nabstract class State { \n    protected TrafficLight light;\n    public State(TrafficLight l) { this.light = l; }\n    abstract void handle(); \n}\n\n// Estados Concretos\nclass RedState extends State { public void handle() { System.out.println("Luz Roja"); light.changeState(new GreenState(light)); } }\nclass GreenState extends State { /* ... */ }`,
            icon: `<svg viewBox="0 0 24 24" fill="none" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2l-4 4h8l-4-4z"></path><path d="M12 22l-4-4h8l-4 4z"></path><path d="M2 12l4-4v8l-4-4z"></path><path d="M22 12l-4-4v8l4-4z"></path></svg>`
        },
        'p-strategy': {
            title: 'Strategy', classification: 'De Comportamiento',
            problem: 'Necesitas definir una familia de algoritmos, encapsular cada uno de ellos y hacerlos intercambiables, permitiendo que un algoritmo varíe independientemente de los clientes que lo usan.',
            advantages: 'Ofrece una alternativa a la herencia para variar el comportamiento. Reduce el número de sentencias condicionales. Permite elegir la implementación en tiempo de ejecución.',
            disadvantages: 'Los clientes deben conocer las diferentes estrategias para poder seleccionar la adecuada. Aumenta el número de objetos en la aplicación.',
            usage: 'En una aplicación de comercio electrónico, para ofrecer diferentes métodos de envío (Estándar, Express, Urgente), donde cada uno es una estrategia de cálculo de costos y tiempos.',
            diagram: 'https://placehold.co/600x350/e0e5f0/333?text=Diagrama+Strategy',
            code: `// Estrategia\ninterface SortStrategy { void sort(List<Integer> list); }\n\n// Estrategias Concretas\nclass BubbleSortStrategy implements SortStrategy { public void sort(List<Integer> list) { /* ... */ } }\nclass QuickSortStrategy implements SortStrategy { public void sort(List<Integer> list) { /* ... */ } }\n\n// Contexto\nclass Sorter {\n    private SortStrategy strategy;\n    public void setStrategy(SortStrategy s) { this.strategy = s; }\n    public void sortList(List<Integer> list) { strategy.sort(list); }\n}`,
            icon: `<svg viewBox="0 0 24 24" fill="none" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2v6"></path><path d="M12 8l-4 4h8l-4-4z"></path><path d="M4 14h16"></path><path d="M4 18h16"></path></svg>`
        },
        'p-template-method': {
            title: 'Template Method', classification: 'De Comportamiento',
            problem: 'Necesitas definir el esqueleto de un algoritmo en una operación (en una superclase), delegando algunos pasos a las subclases para que puedan redefinirlos sin cambiar la estructura del algoritmo.',
            advantages: 'Fomenta la reutilización de código. Permite que las subclases personalicen partes de un algoritmo sin modificar su estructura general.',
            disadvantages: 'Puede ser difícil de mantener si el esqueleto del algoritmo cambia con frecuencia.',
            usage: 'En un framework, para definir el flujo de ejecución de un proceso (ej. un test unitario: `setUp`, `runTest`, `tearDown`), permitiendo que el usuario solo implemente los pasos específicos.',
            diagram: 'https://placehold.co/600x350/e0e5f0/333?text=Diagrama+Template+Method',
            code: `// Clase Abstracta (con el Template Method)\nabstract class DataMiner {\n    // El template method\n    public final void mine(String path) {\n        openFile(path);\n        extractData();\n        parseData();\n        closeFile();\n    }\n    protected abstract void extractData();\n    protected abstract void parseData();\n    private void openFile(String path) { /* ... */ }\n    private void closeFile() { /* ... */ }\n}\n\n// Clase Concreta\nclass PDFDataMiner extends DataMiner {\n    protected void extractData() { /* Implementación para PDF */ }\n    protected void parseData() { /* Implementación para PDF */ }\n}`,
            icon: `<svg viewBox="0 0 24 24" fill="none" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16v16H4z"></path><path d="M8 10h8"></path><path d="M8 14h4"></path><path d="M4 8h16"></path></svg>`
        },
        'p-visitor': {
            title: 'Visitor', classification: 'De Comportamiento',
            problem: 'Necesitas representar una operación que se realizará sobre los elementos de una estructura de objetos, permitiendo definir nuevas operaciones sin cambiar las clases de los elementos sobre los que operan.',
            advantages: 'Facilita la adición de nuevas operaciones que dependen de la estructura de objetos. Acumula operaciones relacionadas en una sola clase.',
            disadvantages: 'Añadir una nueva subclase (ElementoConcreto) a la estructura de objetos es difícil, ya que requiere actualizar la interfaz del Visitor y todas sus implementaciones.',
            usage: 'En un compilador, para realizar diferentes operaciones (comprobación de tipos, generación de código) sobre un Árbol de Sintaxis Abstracto (AST) sin modificar los nodos del árbol.',
            diagram: 'https://placehold.co/600x350/e0e5f0/333?text=Diagrama+Visitor',
            code: `// Visitante\ninterface Visitor { void visit(Book book); void visit(Fruit fruit); }\n\n// Elemento\ninterface ItemElement { void accept(Visitor visitor); }\nclass Book implements ItemElement { public void accept(Visitor v) { v.visit(this); } }\nclass Fruit implements ItemElement { public void accept(Visitor v) { v.visit(this); } }\n\n// Visitante Concreto\nclass ShoppingCartVisitor implements Visitor {\n    public void visit(Book book) { /* Calcula costo de envío para libro */ }\n    public void visit(Fruit fruit) { /* Calcula costo de envío para fruta */ }\n}`,
            icon: `<svg viewBox="0 0 24 24" fill="none" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2L2 7l10 5 10-5-10-5z"></path><path d="M2 17l10 5 10-5"></path><path d="M2 12l10 5 10-5"></path></svg>`
        }
    };

    // --- DOM Elements ---
    const treeContainer = document.getElementById('tree-container');
    const infoPanel = document.getElementById('info-panel');
    const infoPanelClose = document.getElementById('info-panel-close');
    const svg = document.querySelector('.connections-svg');

    // --- LOGIC ---
    function init() {
        const startNode = document.getElementById('start');
        startNode.addEventListener('click', () => {
            if(document.getElementById('level-1').classList.contains('hidden')){
                revealLevel('level-1', 'start');
                startNode.classList.add('selected');
            }
        }, { once: true });
    }

    treeContainer.addEventListener('click', (e) => {
        const node = e.target.closest('.node.clickable');
        if (!node) return;

        const codeLink = e.target.closest('.code-link');

        if (codeLink) {
            e.preventDefault();
            e.stopPropagation();
            const patternId = codeLink.dataset.patternId;
            showInfoPanel(patternId, 'code');
            selectNode(node);
            return;
        }
        
        if (node.classList.contains('node-pattern')) {
            showInfoPanel(node.id, 'diagram');
            selectNode(node);
            return;
        }

        const targetId = node.dataset.target;
        if (targetId) {
            selectNode(node);
            if (targetId.startsWith('level-')) {
                 revealLevel(targetId, node.id);
            } else {
                 revealNode(targetId, node.id);
            }
        }
    });

    function selectNode(node) {
        const parentLevel = node.parentElement;
        parentLevel.querySelectorAll('.node').forEach(sibling => sibling.classList.remove('selected'));
        node.classList.add('selected');
    }

    function revealLevel(levelId, sourceNodeId) {
        const levelElement = document.getElementById(levelId);
        if (levelElement) {
            levelElement.classList.remove('hidden');
            const sourceNode = document.getElementById(sourceNodeId);
            const targetNode = levelElement.querySelector('.node-question') || levelElement.querySelector('.node');
            drawLine(sourceNode, targetNode);
        }
    }

    function revealNode(nodeId, sourceNodeId) {
        const nodeElement = document.getElementById(nodeId);
        if (nodeElement) {
            const level3 = document.getElementById('level-3');
            if (level3.classList.contains('hidden')) {
                level3.classList.remove('hidden');
            }
            nodeElement.classList.remove('hidden');
            const sourceNode = document.getElementById(sourceNodeId);
            drawLine(sourceNode, nodeElement);
            if (nodeElement.classList.contains('node-pattern')) {
                selectNode(nodeElement);
                showInfoPanel(nodeId, 'diagram');
            }
        }
    }
    
    function drawLine(sourceEl, targetEl) {
        if (!sourceEl || !targetEl) {
            console.error("drawLine called with a null element.", { sourceEl, targetEl });
            return;
        }
        const containerRect = treeContainer.getBoundingClientRect();
        const sourceRect = sourceEl.getBoundingClientRect();
        const targetRect = targetEl.getBoundingClientRect();

        const x1 = sourceRect.right - containerRect.left + treeContainer.scrollLeft;
        const y1 = sourceRect.top - containerRect.top + sourceRect.height / 2;
        const x2 = targetRect.left - containerRect.left + treeContainer.scrollLeft;
        const y2 = targetRect.top - containerRect.top + targetRect.height / 2;

        const line = document.createElementNS('http://www.w3.org/2000/svg', 'path');
        const d = `M ${x1} ${y1} C ${x1 + 40} ${y1}, ${x2 - 40} ${y2}, ${x2} ${y2}`;
        line.setAttribute('d', d);
        line.setAttribute('stroke', 'var(--border-color)');
        line.setAttribute('stroke-width', '2');
        line.setAttribute('fill', 'none');
        svg.appendChild(line);
    }
    
    function showInfoPanel(patternId, activeTab = 'diagram') {
        try {
            const data = patternData[patternId];
            if (!data) {
                console.error(`No data found for patternId: ${patternId}`);
                return;
            }

            // Populate text content
            const setText = (id, text) => {
                const el = document.getElementById(id);
                if (el) el.textContent = text;
            };

            const setHTML = (id, html) => {
                const el = document.getElementById(id);
                if(el) el.innerHTML = html;
            }

            setText('info-title', data.title || 'N/A');
            setText('info-classification', `Clasificación: ${data.classification || 'N/A'}`);
            setText('info-problem', data.problem || 'N/A');
            setText('info-advantages', data.advantages || 'N/A');
            setText('info-disadvantages', data.disadvantages || 'N/A');
            setText('info-usage', data.usage || 'N/A');
            setHTML('info-icon-container', data.icon || '');

            const principleTitle = document.getElementById('info-principle-title');
            const principleP = document.getElementById('info-principle');
            if (principleTitle && principleP) {
                 if (data.principle) {
                    principleP.textContent = data.principle;
                    principleTitle.classList.remove('hidden');
                    principleP.classList.remove('hidden');
                } else {
                    principleTitle.classList.add('hidden');
                    principleP.classList.add('hidden');
                }
            }
           
            const diagramImg = document.getElementById('info-diagram-img');
            if(diagramImg) diagramImg.src = data.diagram || '';
            
            const codeSnippet = document.getElementById('info-code-snippet');
            if(codeSnippet) codeSnippet.textContent = data.code || '// No hay código de ejemplo disponible.';

            const diagramTabLink = infoPanel.querySelector('.tab-link[data-tab="diagram-content"]');
            const codeTabLink = infoPanel.querySelector('.tab-link[data-tab="code-content"]');
            const diagramContent = document.getElementById('diagram-content');
            const codeContent = document.getElementById('code-content');
            
            if(diagramTabLink && codeTabLink && diagramContent && codeContent) {
                diagramTabLink.classList.remove('active');
                codeTabLink.classList.remove('active');
                diagramContent.classList.remove('active');
                codeContent.classList.remove('active');

                if (activeTab === 'code') {
                    codeTabLink.classList.add('active');
                    codeContent.classList.add('active');
                } else {
                    diagramTabLink.classList.add('active');
                    diagramContent.classList.add('active');
                }
            }

            infoPanel.classList.add('visible');

        } catch (error) {
            console.error("Error showing info panel:", error);
        }
    }

    infoPanel.querySelector('.tabs').addEventListener('click', (e) => {
        if(e.target.classList.contains('tab-link')) {
            const tabId = e.target.dataset.tab;
            infoPanel.querySelectorAll('.tab-link').forEach(t => t.classList.remove('active'));
            infoPanel.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            e.target.classList.add('active');
            infoPanel.querySelector(`#${tabId}`).classList.add('active');
        }
    });

    infoPanelClose.addEventListener('click', () => {
        infoPanel.classList.remove('visible');
    });

    init();
});
</script>

</body>
</html>